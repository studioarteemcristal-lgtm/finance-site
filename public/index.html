<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastro de valores</title>

    <!-- Importa o Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

</head>
<body>

    <h1>Cadastro de valores</h1>

    <input type="text" id="tipo" placeholder="Tipo (ex: venda)">
    <input type="number" id="valor" placeholder="Valor">
    <button onclick="salvar()">Salvar</button>

    <h2>Valores lançados</h2>
    <div id="lista">Carregando...</div>

    <script>
        // -----------------------------
        // CONFIGURAÇÃO SUPABASE NOVA
        // -----------------------------
        const supabaseUrl = "https://rdfkelztyromqcwdppon.supabase.co";
        const supabaseKey = "sb_publishable_5S54OFP0_TAk1WSP6qwTVcA_C0V2uSJZ"; // Publishable Key
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        // -----------------------------------------
        // FUNÇÃO PARA SALVAR
        // -----------------------------------------
        async function salvar() {
            const tipo = document.getElementById("tipo").value;
            const valor = document.getElementById("valor").value;

            const { error } = await supabaseClient
                .from("lancamentos")
                .insert([{ tipo, valor }]);

            if (error) {
                alert("Erro ao salvar: " + error.message);
                return;
            }

            alert("Salvo com sucesso!");
            carregar();
        }

        // -----------------------------------------
        // FUNÇÃO PARA CARREGAR OS DADOS
        // -----------------------------------------
        async function carregar() {
            const listaDiv = document.getElementById("lista");

            const { data, error } = await supabaseClient
                .from("lancamentos")
                .select("*")
                .order("id", { ascending: false });

            if (error) {
                listaDiv.innerHTML = "Erro ao carregar: " + error.message;
                return;
            }

            if (data.length === 0) {
                listaDiv.innerHTML = "Nenhum valor lançado ainda.";
                return;
            }

            listaDiv.innerHTML = data.map(item =>
                `<p><strong>${item.tipo}:</strong> R$ ${item.valor}</p>`
            ).join("");
        }

        // Carrega ao abrir a página
        carregar();
    </script>

</body>
</html>
